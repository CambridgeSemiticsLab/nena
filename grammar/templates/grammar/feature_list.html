{% extends 'nena.html' %}
{% load static %}

{% block subtitle %}
  {% if section and dialect %}
    {{section}} in {{dialect.name}}
  {% elif section %}
    {{section}}
  {% elif dialect %}
    Grammatical description of {{dialect.name}}
  {% else %}
    Grammatical description
  {% endif %}
{% endblock %}

{% block page_content %}
  {% if dialect %}
  <p class="p-3">
    {% if section %}
    This section has {{num_features}} of the
    <a href="{% url 'dialects:dialect-grammar' dialect.id %}">{{total_features}} total features</a>
    detailed for the dialect
    {% else %}
    This dialect has {{num_features}} features
    {% endif %}
  </p>
  {% endif %}

  <p class="p-3">
    <button class="button pill" onclick="$('#grammar_tree .pop_open').prop('checked', true)">
      Open all
    </button>
    <button class="button pill" onclick="$('#grammar_tree .pop_open').prop('checked', false)">
      Close all
    </button>

    {% if dialect %}
    <label class="ilb">
      <input class="chex" type="checkbox" checked onchange="$('#grammar_tree').toggleClass('show_entries')">
      Show with entries
    </label>
    <label class="ilb">
      <input class="chex" type="checkbox" checked onchange="$('#grammar_tree').toggleClass('show_empties')">
      Show without entries
    </label>
    {% endif %}

  </p>
  <ul id="grammar_tree" class="show_entries show_empties {{dialect|yesno:',grammar_only'}}">
    {% for feature, info in feature_list %}
      {% if info.open and not forloop.first %}
        <div class='folder'></div>
        <input type="checkbox" class="pop_open" id="pop_open_{{forloop.counter}}" {%if feature_list|length < 100%}checked{%endif%}>
        <ul>
      {% elif not forloop.first %}
      </li>
      {% endif %}

      <li class="level_{{info.level}} {% spaceless %}
                   {% if info.has_entry or info.entry %} has_entry {% endif %}
                   {% if info.has_empty or num_features == 0 %} has_empty {% endif %}{% endspaceless %}">

        <label for="pop_open_{{forloop.counter|add:'1'}}">
          {{feature|safe}}
          {% if feature.fullheading %}
          <a class="section_link" href="{% spaceless %}
              {% if dialect %}
                {% url 'dialects:dialect-grammar-section' dialect.id feature.fullheading %}
              {% else %}
                {% url 'grammar:feature-list-section' feature.fullheading %}
              {% endif %}
              {% endspaceless %}" title="show just this section">ยง</a>
          {% endif %}
        </label>

        {% if info.entry %}
        <div class="example">
          {{info.entry|safe}}
          <a class="details_link" href="{% url 'dialects:dialect-feature' dialect.id info.df_id %}">
            details &raquo;
          </a>
        </div>
        {% elif info.dialect_count %}
        <div class="example">
          {% with n=info.dialect_count %}
          <a href="{% url 'grammar:feature-detail' feature.id %}">
            {{n}} dialect{{n|pluralize}}
          </a>
          {{n|pluralize:'has,have'}} this feature
          {% endwith %}
        </div>
        {% endif %}

      {% for close in info.close %}
      </li></ul>
      {% endfor %}
    {% endfor %}
  </ul>
{% endblock %}
